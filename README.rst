.. -*- rst -*-

Neurodriver / Brian2GeNN Performance Comparison
===============================================

Description
-----------
This code can be used to compare the performance of
`Neurodriver <https://github.com/neurokernel/neurodriver>`_ and
`Brian2GeNN <https://github.com/brian-team/brian2genn>`_
when both are used to simulate a network of randomly connected Leaky IAF neurons
connected by alpha function synapses, where all neurons and synapses are
configured identically and a subset of the neurons are provided
with a constant current input for the duration of the simulation.

To make the comparison as fair as possible, the following methodology is
employed:

- The execution time of the Brian2GeNN simulation measures the duration of
  both the call to the ``brian2.core.magic.run()`` method and the call to
  ``brian2.devices.device.CurrentDeviceProxy.build()`` because Brian2GeNN cannot
  currently reuse generated code in a new simulation run. Output generated by
  the generated GeNN binary is saved to disk and loaded into Brian data
  structures after it finishes running.
- Since the constant input to the Neurodriver simulation is copied into
  the requisite variables at every step of the simulation, the constant input
  to the Brian2GeNN simulation is set at every execution step via
  ``brian2.NeuronGroup.run_regularly()`` (Brian2 timed arrays are currently not
  supported by Brian2GeNN).
- Spike states generated during each run step of the Neurodriver simulation
  are copied to host memory after each step. States are saved to pagelocked
  memory to accelerate this copy operation.
- The execution time of the Neurodriver simulation measures the duration of the
  simulation's entire run loop; this excludes initialization of variables used
  during the simulation and saving of the output to disk at the end of
  the run loop, but includes copying of the generated spike states to host
  memory described above.

Parameters
----------
- Simulation duration: 3 s
- Time resolution: 1e-4 s

Required Software
-----------------
- Brian2: `71f1274 <https://github.com/brian-team/brian2/commit/71f1274>`_
- Brian2GeNN: `a00d759 <https://github.com/brian-team/brian2genn/commit/a00d759>`_
- GeNN: `0cb5825 <https://github.com/genn-team/genn/commit/0cb5825>`_
- `Matplotlib <https://matplotlib.github.io>`_
- Neurodriver: `3a00ff0 <https://github.com/neurokernel/neurodriver/commit/3a00ff0>`_
- Neurokernel: `e8fec4b <https://github.com/neurokernel/neurokernel/commit/e8fec4b>`_
- `Neurokernel dependencies <https://github.com/neurokernel/neurokernel/blob/master/setup.py>`_
- `Python 2.7 <http://www.python.org/>`_
- `sarge <https://github.com/vsajip/sarge>`_

Usage
-----
1. Run ``python run_brian2genn.py > brian2genn.log`` to generate benchmarks for
   the Brian2GeNN simulation.
2. Run ``python run_nk.py > nk.log`` to generate benchmarks for the
   Neurodriver simulation.
3. Run ``python plot_benchmark.py`` to generate a plot comparing the benchmarks.

Notes
-----
It may be necessary to `patch <https://github.com/genn-team/genn/commit/e0f3480a2cb04dd04b45556d14e1b9f7ee986f00>`_ GeNN to run the benchmarks on certain GPUs.

Authors & Acknowledgements
--------------------------
See the included `AUTHORS`_ file for more information.

.. _AUTHORS: AUTHORS.rst

License
-------
All files that make use of Brain2GeNN are licensed under the
`GPLv2 <http://opensource.org/licenses/GPL-2.0>`_ license.
All files that make use of Neurodriver and Neurokernel are licensed under
the `BSD License
<http://www.opensource.org/licenses/bsd-license.php>`_.
See the included `LICENSE`_ file for more information.

.. _LICENSE: LICENSE.rst
